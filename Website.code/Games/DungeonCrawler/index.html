<!-- AI Agent: Check AI_AGENT_GUIDE.md for project instructions including changelog requirements -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dungeon Crawler Game</title>
    
    <!-- Tailwind CSS -->
    <link href="/dist/tailwind.css" rel="stylesheet">
    <!-- Game Navigation Styling -->
    <link href="/Games/DungeonCrawler/game-nav.css?v=20260115" rel="stylesheet">
    
    <link rel="icon" type="image/png" href="/Images/favicon.png">
    
    <!-- Font Awesome Icons Library for professional UI icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom styles for game-specific elements -->
    <style>
        /* Pulse animation for dangerous choices */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(244, 67, 54, 0); }
            100% { box-shadow: 0 0 0 0 rgba(244, 67, 54, 0); }
        }
        
        .risk-btn.dangerous {
            animation: pulse 1.5s infinite;
        }
        
        /* Victory glow animation */
        @keyframes victoryGlow {
            0% { box-shadow: 0 0 5px rgba(255, 215, 0, 0.8); }
            50% { box-shadow: 0 0 20px rgba(255, 215, 0, 1), 0 0 30px rgba(255, 215, 0, 0.7); }
            100% { box-shadow: 0 0 5px rgba(255, 215, 0, 0.8); }
        }
        
        .victory-share-btn {
            animation: victoryGlow 2s infinite;
        }
        
        /* Spell choice button styling - ensure backgrounds show */
        .spell-choice-btn {
            background: linear-gradient(to right, rgb(147, 51, 234), rgb(168, 85, 247)) !important;
            color: white !important;
            padding: 0.75rem 1.25rem;
            border-radius: 9999px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        
        .spell-choice-btn:hover {
            background: linear-gradient(to right, rgb(168, 85, 247), rgb(192, 132, 252)) !important;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }
    </style>
</head>
<body class="font-mono min-h-screen px-3 pb-3" style="background: linear-gradient(135deg, rgba(42, 24, 80, 0.95) 0%, rgba(24, 24, 32, 0.9) 60%, rgba(67, 234, 124, 0.2) 100%);">
    
    <!-- MAIN GAME CONTAINER -->
    <div class="max-w-[95vw] w-full mx-auto bg-black/70 rounded-xl p-3 shadow-[0_0_20px_rgba(0,255,255,0.3)]">
        
        <!-- HEADER SECTION -->
        <div class="text-center mb-1 text-white">
            <h1 class="text-base md:text-lg font-extrabold mb-0 game-title whitespace-nowrap overflow-hidden inline-block">
                <i class="fas fa-sword"></i> Dungeon Crawler <span class="text-xs md:text-sm text-gray-400">| Text-Based RPG</span> <i class="fas fa-shield-alt"></i>
            </h1>
        </div>
        
        <!-- GAME STATISTICS & PANELS (compact, one row) -->
        <div id="dashboard-panels" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-2 mb-4 text-sm">
            <div class="panel panel-stats panel-compact">
                <h3 class="text-xl mb-2"><i class="fas fa-chart-line"></i> Game Stats</h3>
                    <p class="text-sm text-gray-300">Class: <span id="player-class" class="font-bold text-purple-300">-</span></p>
                <p><i class="fas fa-coins"></i> Gold: <span id="player-gold-main" class="text-yellow-400 font-bold">0</span></p>
                <p>Level: <span id="level">1</span> | XP: <span id="exp">0</span>/<span id="exp-needed">50</span></p>
                <p>Lives: <span id="lives">3</span></p>
                <p>Turn: <span id="turn-counter">0</span>/150</p>
                <p>Depth: <span id="depth-display">0</span>/10</p>
            </div>
            
            <!-- Inventory Panel - always visible -->
            <div class="panel panel-inventory panel-compact">
                <h3 class="text-xl mb-2"><i class="fas fa-backpack"></i> Inventory</h3>
                    <p class="text-sm subtle-text"><i class="fas fa-flask"></i> Potions: <span id="potion-count" class="text-green-400 font-bold">0</span></p>
                    <p class="text-sm subtle-text"><i class="fas fa-flask" style="color: #4169E1"></i> Mana Potions: <span id="mana-potion-count" class="text-blue-400 font-bold">0</span></p>
                    <p class="text-sm subtle-text"><i class="fas fa-gem"></i> Gems: <span id="gem-count" class="text-cyan-400 font-bold">0</span></p>
                    <p class="text-sm subtle-text mt-2"><i class="fas fa-trophy"></i> Kills: <span id="enemy-kills" class="font-bold">0</span></p>
                <div id="equipment-display" class="mt-3 divider">
                    <p class="text-xs font-bold text-purple-300 mb-1">EQUIPMENT</p>
                    <p id="weapon-slot" class="text-xs subtle-text">Weapon: None</p>
                    <p id="armor-slot" class="text-xs subtle-text">Armor: None</p>
                    <p id="accessory-slot" class="text-xs subtle-text">Accessory: None</p>
                </div>
                <p id="vampire-status" class="hidden mt-2 text-sm text-red-400 font-bold"><i class="fas fa-moon"></i> VAMPIRE</p>
            </div>
            
            <!-- Quick Tips Panel - always visible -->
            <div class="panel panel-tips panel-compact">
                <h3 class="text-xl mb-2"><i class="fas fa-lightbulb"></i> Quick Tips</h3>
                <p class="text-xs subtle-text mb-1"><i class="fas fa-check"></i> Rest to recover HP/Mana</p>
                <p class="text-xs subtle-text mb-1"><i class="fas fa-check"></i> Equipment drops from enemies</p>
                <p class="text-xs subtle-text mb-1"><i class="fas fa-check"></i> Spells cost mana but deal more damage</p>
                <p class="text-xs subtle-text mb-1"><i class="fas fa-check"></i> Higher agility = attack first</p>
                <p class="text-xs subtle-text mb-1"><i class="fas fa-check"></i> Mana potions restore 30 mana instantly</p>
                <div id="class-tips" class="mt-2">
                    <!-- Class-specific tips appear here -->
                </div>
                <p class="text-xs subtle-text mt-2"><i class="fas fa-check"></i> Reach depth 10 and defeat the boss to win!</p>
            </div>
            
            <!-- Progress Panel - always visible -->
            <div class="panel panel-progress panel-compact">
                <h3 class="text-xl mb-2"><i class="fas fa-tasks"></i> Progress</h3>
                <p class="text-sm text-gray-300">Exploration: <span id="exploration-percent" class="text-cyan-400 font-bold">0%</span></p>
                <div class="progress progress-sm mt-1 mb-2"><div class="progress-fill mana" id="exploration-bar" style="width:0%"></div></div>
                <p class="text-xs subtle-text"><i class="fas fa-crosshairs"></i> Current Floor: <span id="floor-name" class="font-bold">Entrance</span></p>
            </div>
        </div>
        
        <!-- CHARACTER + ENEMY: compact side-by-side layout -->
        <div id="status-panels" class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
        <div class="panel panel-character panel-compact text-white">
            <h3 class="text-xl font-bold mb-3"><i class="fas fa-user-shield"></i> Your Character</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div>
                    <p class="mb-1 hp-section">HP: <span id="player-hp">80</span>/<span id="player-max-hp">80</span></p>
                    <div class="progress mb-2"><div class="progress-fill hp" id="player-hp-bar" style="width:100%"></div></div>
                    <p class="mb-1 mana-section">Mana: <span id="player-mana">40</span>/<span id="player-max-mana">40</span></p>
                    <div class="progress mb-1"><div class="progress-fill mana" id="player-mana-bar" style="width:100%"></div></div>
                </div>
                <div class="stats-section">
                    <p><i class="fas fa-fist-raised"></i> Strength: <span id="player-strength">18</span></p>
                    <p><i class="fas fa-wind"></i> Agility: <span id="player-agility">12</span> (Initiative)</p>
                    <p><i class="fas fa-shield"></i> Defense: <span id="player-defense">5</span></p>
                    <p><i class="fas fa-wand-magic-sparkles"></i> Power: <span id="player-power">10</span></p>
                    <p><i class="fas fa-sword"></i> Physical Mastery: <span id="physical-mastery">0</span></p>
                    <p><i class="fas fa-magic"></i> Magical Mastery: <span id="magical-mastery">0</span></p>
                </div>
            </div>
        </div>
        
        <!-- ENEMY INFORMATION (compact) -->
        <div class="panel panel-enemy panel-compact hidden" id="enemy-panel">
            <h3 class="text-xl font-bold mb-3"><i class="fas fa-skull"></i> Current Enemy</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div>
                    <p class="text-lg font-bold mb-2"><span id="enemy-name">Goblin</span></p>
                    <p class="mb-1">HP: <span id="enemy-hp">30</span>/<span id="enemy-max-hp">30</span></p>
                    <div class="progress"><div class="progress-fill hp" id="enemy-hp-bar" style="width:100%"></div></div>
                    <p class="mt-2 mb-1">Mana: <span id="enemy-mana">0</span>/<span id="enemy-max-mana">0</span></p>
                    <div class="progress"><div class="progress-fill mana" id="enemy-mana-bar" style="width:0%"></div></div>
                </div>
                <div>
                    <p><i class="fas fa-sword"></i> Attack: <span id="enemy-attack">10</span></p>
                    <p><i class="fas fa-shield-alt"></i> Defense: <span id="enemy-defense">5</span></p>
                </div>
            </div>
        </div>
        </div>

        <!-- PLAYER CONTROLS (moved between status and situation) -->
        <div id="controls" class="flex flex-wrap gap-2.5 justify-center mb-6" aria-label="Exploration and combat controls">
            <button onclick="exploreDungeon()" id="explore-btn" class="hidden btn btn-explore"><i class="fas fa-search"></i> Explore</button>
            <button onclick="restAtCamp()" id="rest-btn" class="hidden btn btn-rest"><i class="fas fa-bed"></i> Rest</button>
            <button onclick="usePotion()" id="potion-btn" class="hidden btn btn-potion"><i class="fas fa-flask"></i> Use Potion</button>
            <button onclick="useManaPotion()" id="mana-potion-btn" class="hidden btn btn-mana"><i class="fas fa-flask" style="color: #87CEEB"></i> Use Mana Potion</button>
            <button onclick="Shop.openShop()" id="shop-btn" class="hidden btn btn-shop"><i class="fas fa-store"></i> Shop</button>
            <button onclick="attackEnemy()" id="attack-btn" class="hidden btn btn-attack"><i class="fas fa-sword"></i> Attack</button>
            <button onclick="castSpell()" id="spell-btn" class="hidden btn btn-attack"><i class="fas fa-magic"></i> Cast Spell</button>
            <button onclick="runAway()" id="run-btn" class="hidden btn btn-run"><i class="fas fa-running"></i> Run Away</button>
        </div>
        
        <!-- MAGICAL SHOP -->
        <div class="panel panel-shop hidden mb-5" id="shop-panel">
            <h3 class="text-xl font-bold mb-3"><i class="fas fa-store"></i> Mystical Shop</h3>
            <p class="mb-4"><i class="fas fa-info-circle"></i> Spend your gold on permanent upgrades!</p>
            <div id="shop-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 my-4">
                <div class="bg-indigo-900/30 border border-purple-400 rounded-lg p-4 text-center transition-all hover:bg-indigo-900/40 hover:border-purple-300 hover:-translate-y-0.5">
                    <h4 class="text-lg font-bold mb-2 text-purple-300"><i class="fas fa-heart"></i> Health Boost</h4>
                    <p class="text-sm mb-2">+20 Max HP</p>
                    <p class="text-yellow-400 font-bold my-2">Cost: <span id="cost-health">150</span> gold</p>
                    <button onclick="Shop.buyUpgrade('health')" class="bg-gradient-to-r from-purple-700 to-purple-600 text-white px-4 py-2 rounded-full font-bold transition-all hover:from-purple-600 hover:to-purple-500 hover:-translate-y-0.5 hover:shadow-lg disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none" id="shop-health">Buy</button>
                </div>
                <div class="bg-indigo-900/30 border border-purple-400 rounded-lg p-4 text-center transition-all hover:bg-indigo-900/40 hover:border-purple-300 hover:-translate-y-0.5">
                    <h4 class="text-lg font-bold mb-2 text-purple-300"><i class="fas fa-magic"></i> Mana Boost</h4>
                    <p class="text-sm mb-2">+15 Max Mana</p>
                    <p class="text-yellow-400 font-bold my-2">Cost: <span id="cost-mana">120</span> gold</p>
                    <button onclick="Shop.buyUpgrade('mana')" class="bg-gradient-to-r from-purple-700 to-purple-600 text-white px-4 py-2 rounded-full font-bold transition-all hover:from-purple-600 hover:to-purple-500 hover:-translate-y-0.5 hover:shadow-lg disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none" id="shop-mana">Buy</button>
                </div>
                <div class="bg-indigo-900/30 border border-purple-400 rounded-lg p-4 text-center transition-all hover:bg-indigo-900/40 hover:border-purple-300 hover:-translate-y-0.5">
                    <h4 class="text-lg font-bold mb-2 text-purple-300"><i class="fas fa-fist-raised"></i> Strength Training</h4>
                    <p class="text-sm mb-2">+3 Strength</p>
                    <p class="text-yellow-400 font-bold my-2">Cost: <span id="cost-strength">100</span> gold</p>
                    <button onclick="Shop.buyUpgrade('strength')" class="bg-gradient-to-r from-purple-700 to-purple-600 text-white px-4 py-2 rounded-full font-bold transition-all hover:from-purple-600 hover:to-purple-500 hover:-translate-y-0.5 hover:shadow-lg disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none" id="shop-strength">Buy</button>
                </div>
                <div class="bg-indigo-900/30 border border-purple-400 rounded-lg p-4 text-center transition-all hover:bg-indigo-900/40 hover:border-purple-300 hover:-translate-y-0.5">
                    <h4 class="text-lg font-bold mb-2 text-purple-300"><i class="fas fa-wind"></i> Agility Training</h4>
                    <p class="text-sm mb-2">+3 Agility (Initiative)</p>
                    <p class="text-yellow-400 font-bold my-2">Cost: <span id="cost-agility">100</span> gold</p>
                    <button onclick="Shop.buyUpgrade('agility')" class="bg-gradient-to-r from-purple-700 to-purple-600 text-white px-4 py-2 rounded-full font-bold transition-all hover:from-purple-600 hover:to-purple-500 hover:-translate-y-0.5 hover:shadow-lg disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none" id="shop-agility">Buy</button>
                </div>
                <div class="bg-indigo-900/30 border border-purple-400 rounded-lg p-4 text-center transition-all hover:bg-indigo-900/40 hover:border-purple-300 hover:-translate-y-0.5">
                    <h4 class="text-lg font-bold mb-2 text-purple-300"><i class="fas fa-wand-magic-sparkles"></i> Power Training</h4>
                    <p class="text-sm mb-2">+3 Power (Magic Damage)</p>
                    <p class="text-yellow-400 font-bold my-2">Cost: <span id="cost-power">100</span> gold</p>
                    <button onclick="Shop.buyUpgrade('power')" class="bg-gradient-to-r from-purple-700 to-purple-600 text-white px-4 py-2 rounded-full font-bold transition-all hover:from-purple-600 hover:to-purple-500 hover:-translate-y-0.5 hover:shadow-lg disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none" id="shop-power">Buy</button>
                </div>
                <div class="bg-indigo-900/30 border border-purple-400 rounded-lg p-4 text-center transition-all hover:bg-indigo-900/40 hover:border-purple-300 hover:-translate-y-0.5">
                    <h4 class="text-lg font-bold mb-2 text-purple-300"><i class="fas fa-shield-alt"></i> Combat Mastery</h4>
                    <p class="text-sm mb-2">+2 to both masteries</p>
                    <p class="text-yellow-400 font-bold my-2">Cost: <span id="cost-mastery">200</span> gold</p>
                    <button onclick="Shop.buyUpgrade('mastery')" class="bg-gradient-to-r from-purple-700 to-purple-600 text-white px-4 py-2 rounded-full font-bold transition-all hover:from-purple-600 hover:to-purple-500 hover:-translate-y-0.5 hover:shadow-lg disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none" id="shop-mastery">Buy</button>
                </div>
                <div class="bg-indigo-900/30 border border-green-400 rounded-lg p-4 text-center transition-all hover:bg-indigo-900/40 hover:border-green-300 hover:-translate-y-0.5">
                    <h4 class="text-lg font-bold mb-2 text-green-300"><i class="fas fa-flask"></i> Healing Potion</h4>
                    <p class="text-sm mb-2">Restore 40 HP instantly</p>
                    <p class="text-yellow-400 font-bold my-2">Cost: <span id="cost-potion">100</span> gold</p>
                    <button onclick="Shop.buyUpgrade('potion')" class="bg-purple-700 text-white px-4 py-2 rounded-full font-bold transition-all hover:bg-gradient-to-r hover:from-green-700 hover:to-green-600 hover:-translate-y-0.5 hover:shadow-lg disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none" id="shop-potion">Buy</button>
                </div>
                <div class="bg-indigo-900/30 border border-blue-400 rounded-lg p-4 text-center transition-all hover:bg-indigo-900/40 hover:border-blue-300 hover:-translate-y-0.5">
                    <h4 class="text-lg font-bold mb-2 text-blue-300"><i class="fas fa-flask" style="color: #4169E1"></i> Mana Potion</h4>
                    <p class="text-sm mb-2">Restore 30 Mana instantly</p>
                    <p class="text-yellow-400 font-bold my-2">Cost: <span id="cost-manaPotion">80</span> gold</p>
                    <button onclick="Shop.buyUpgrade('manaPotion')" class="bg-purple-700 text-white px-4 py-2 rounded-full font-bold transition-all hover:bg-gradient-to-r hover:from-blue-700 hover:to-blue-600 hover:-translate-y-0.5 hover:shadow-lg disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none" id="shop-manaPotion">Buy</button>
                </div>
                <div class="bg-indigo-900/30 border border-purple-400 rounded-lg p-4 text-center transition-all hover:bg-indigo-900/40 hover:border-purple-300 hover:-translate-y-0.5">
                    <h4 class="text-lg font-bold mb-2 text-purple-300"><i class="fas fa-heart-broken"></i> Extra Life</h4>
                    <p class="text-sm mb-2">+1 Life (Max 5)</p>
                    <p class="text-yellow-400 font-bold my-2">Cost: <span id="cost-life">500</span> gold</p>
                    <button onclick="Shop.buyUpgrade('life')" class="bg-gradient-to-r from-purple-700 to-purple-600 text-white px-4 py-2 rounded-full font-bold transition-all hover:from-purple-600 hover:to-purple-500 hover:-translate-y-0.5 hover:shadow-lg disabled:bg-gray-600 disabled:cursor-not-allowed disabled:transform-none" id="shop-life">Buy</button>
                </div>
            </div>
            <div class="text-center mt-4">
                <button onclick="Shop.closeShop()" class="bg-gradient-to-r from-gray-700 to-gray-600 text-white px-5 py-2.5 rounded-full font-bold text-base transition-all hover:from-gray-600 hover:to-gray-500">Close Shop</button>
            </div>
        </div>
        
        <!-- ENEMY INFORMATION moved into compact grid above -->
        
        <!-- CLASS SELECTION SCREEN (hidden by default) -->
        <div id="class-selection-screen" class="hidden panel mb-5">
            <h2 class="text-3xl font-bold mb-4 text-center"><i class="fas fa-users"></i> Choose Your Class</h2>
            <p class="text-center mb-6 text-gray-300">Select a class to define your playstyle and abilities</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="class-cards-container">
                <!-- Class cards will be generated by JavaScript -->
            </div>
        </div>
        
        <!-- GAME NARRATIVE AREA (wider emphasis) -->
        <div class="panel panel-narrative panel-wide mb-5 min-h-[220px]" id="situation-panel">
            <div id="game-story">
                <h3 class="text-2xl font-bold mb-3"><i class="fas fa-dungeon"></i> Welcome to Dungeon Crawler!</h3>
                <p class="mb-2">You find yourself at the entrance of a mysterious dungeon. Dark passages stretch before you, filled with unknown dangers and treasures.</p>
                <p>What would you like to do?</p>
            </div>
            <!-- START NEW GAME BUTTON centered at bottom -->
            <div class="start-new-game-wrapper">
                <button onclick="startNewGame()" class="btn btn-run"><i class="fas fa-redo"></i> Start New Game</button>
            </div>
        </div>
        
        <!-- SPELL SELECTION -->
        <div class="panel panel-spell hidden mb-5" id="spell-selector">
            <h3 class="text-lg font-bold mb-2"><i class="fas fa-magic"></i> Select Spell</h3>
            <div class="flex flex-col sm:flex-row gap-3 items-center">
                <select id="spell-dropdown" onchange="selectSpell()" class="select font-bold flex-1">
                    <option value="Magic Missile">Magic Missile</option>
                </select>
                <div id="spell-info" class="text-sm text-gray-300 flex-1">
                    <p><i class="fas fa-bolt"></i> Cost: <span id="spell-cost">15</span> mana</p>
                    <p><i class="fas fa-info-circle"></i> <span id="spell-description">A basic magical projectile</span></p>
                    <p id="spell-effectiveness" class="hidden"></p>
                </div>
            </div>
        </div>
        
        
        <!-- EVENT LOG -->
        <div class="panel panel-log h-[180px] overflow-y-scroll text-sm leading-relaxed" style="display: flex; flex-direction: column;">
            <div id="game-log">
                <p class="text-yellow-400">Game initialized. Click 'Start New Game' to begin your adventure!</p>
            </div>
        </div>
        
    </div>
    
        <!-- Error overlay for easier debugging on module load issues -->
        <div id="error-overlay" style="display:none; position:fixed; top:0; left:0; right:0; z-index:9999; background: rgba(24,24,32,0.98); color:#ff6b6b; padding: 12px 16px; border-bottom: 2px solid #ff6b6b; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;">
            <strong>Game failed to load.</strong>
            <span id="error-overlay-msg" style="color:#ffd7d7; margin-left:8px"></span>
        </div>
    
        <!-- JAVASCRIPT INTEGRATION -->
        <!-- Load as ES6 module with dynamic import to catch errors -->
        <script>
            (function(){
                function showError(e){
                    const el = document.getElementById('error-overlay');
                    const msg = document.getElementById('error-overlay-msg');
                    if (el && msg){
                        el.style.display = 'block';
                        msg.textContent = (e && (e.message || e.toString())) ? `Reason: ${e.message || e.toString()}` : '';
                    }
                    console.error('Dungeon Crawler load error:', e);
                }
                window.addEventListener('error', function(e){ showError(e.error || e.message || e); });
                window.addEventListener('unhandledrejection', function(e){ showError(e.reason || e); });
                try {
                    import('./script.js?v=20260115-003').catch(showError);
                } catch (e) {
                    showError(e);
                }
            })();
        </script>
</body>
</html>